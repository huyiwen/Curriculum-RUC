# 优化
## 基本块优化
没有跳转, 没有停止的一组相邻语句
### 确认基本块
- 确认开头
  - 输入的第一条语句是一个基本块的开头
  - 跳转语句的目标语句是一个基本块的开头
  - 跳转语句的下一句是一个基本块的开头
  - 即在`goto`语句后划分一段, 在`goto`的目标前划分一段
- 从一个开头到下一个开头之间是一个基本块

### 控制流
- 一个基本块为一个节点, 有向边为**跳转(`goto`)**, 即控制流\

### 基本块的值
基本块出口处活动名称的值, 是基本块的值, 在不改变基本块的值的前提下, 做出如下优化:

#### 删除冗余表达式
- 在某一个基本块中, 如果变量都没有发生改变的情况下, 一个表达式重复出现, 则除第一次外都是冗余表达式

#### 复写传播
假设程序段
```c++
int array[10];
int a = 2;
int b = a;

int c = array[b];
```
则可以直接把`array[b]`改写为`array[2]`

#### 删除无用代码
如果对于一个变量`x`求值后再也没有引用`x`, 则这个代码是无用的

#### 削弱计算强度
- `x = y**2`转化为`x = y*y`
- 删除`x += 0`, `x *= 1`这类算式

#### 删除归纳变量
```c++
int i = 2;
int j = 2*i;
```
则`j`是`i`的归纳变量；

## 局部优化
叶节点: 某个/某些标识符的值, 或者是常数
内部节点: 运算符
### 四元式分组
- 0型
  - `A := B`即`(:=, B, -, A)`
- 1型
  - `A := op(B)`即`(op, B, -, A)`
- 2型
  - `A := op(B,C)`即`(op, B, C, A)`
### 算法
从一个基本块的四元式组构造一个无向图
- **值为同一个常量的变量共享一个节点**
- **临时构造的常量节点删除, 比如`y = 2*x`中`2`对应的节点是不会存在的, 除非有`z=2`这种表达式**

## 循环优化
- 画出控制流图后, 找到循环

### 代码外提
- 找到循环中不变的代码, 将其放在循环外计算
### 强度削弱
### 删除归纳变量

## 活跃变量的数据流方程
提取在某个基本块中定义的变量, 和在该基本块中引用的变量